<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ðŸŽ‰</title>
  <style>
    html,body{
      height:100%;margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans";
      background:linear-gradient(180deg,#071020 0%,#0b1530 100%);
      overflow:hidden;
      display:flex;align-items:center;justify-content:center;
    }
    /* Minimal UI */
    .wrap{position:relative;display:flex;flex-direction:column;align-items:center;gap:20px;
          background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.06);
          border-radius:18px;padding:28px 32px;box-shadow:0 10px 40px rgba(2,8,23,.6);z-index:4}
    button#startBtn{background:#f59e0b;border:none;color:#08101a;
          padding:14px 22px;border-radius:14px;font-weight:900;font-size:18px;cursor:pointer}
    .count{font-size:70px;font-weight:900;color:#f59e0b;letter-spacing:2px}
    /* Centered image overlay (stays visible) */
    .overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:2}
    .overlay img{width:800px;max-width:90vw;height:auto;border-radius:16px;
                 box-shadow:0 0 40px rgba(0,0,0,0.6);border:2px solid rgba(255,255,255,0.1)}
    /* Fireworks canvas above everything */
    canvas#fx{position:fixed;inset:0;pointer-events:none;z-index:3}
  </style>
</head>
<body>
  <div class="wrap" id="ui">
    <button id="startBtn">Start</button>
    <div id="count" class="count">00:10</div>
  </div>

  <div class="overlay" id="overlay">
    <img id="fullImg" alt="ðŸŽ‰" src="congrats.jpg">
  </div>

  <canvas id="fx"></canvas>

<script>
const DURATION_SEC = 10;
const IMAGE_URL = "congrats.jpg";
const AUDIO_URL = "song.mp3";

(() => {
  const ui=document.getElementById('ui');
  const startBtn=document.getElementById('startBtn');
  const countEl=document.getElementById('count');
  const overlay=document.getElementById('overlay');

  let timer=null,remaining=DURATION_SEC,audio;

  const fmt=s=>String(Math.floor(s/60)).padStart(2,'0')+':'+String(s%60).padStart(2,'0');
  const render=()=>{countEl.textContent=fmt(remaining);}; render();

  startBtn.addEventListener('click', async ()=>{
    // prepare audio
    audio=new Audio(AUDIO_URL); audio.muted=true;
    try{ await audio.play(); }catch(e){}
    remaining=DURATION_SEC; render();
    if(timer) clearInterval(timer);
    timer=setInterval(()=>{
      remaining--; render();
      if(remaining<=0){ clearInterval(timer); finish(); }
    },1000);
  });

  async function finish(){
    // Hide the whole UI block (Start + countdown)
    ui.style.display='none';

    // Show centered image
    overlay.style.display='flex';

    // Start infinite fireworks loop
    startFireworks(); // no timeout â€” runs forever

    // Play audio (unmute + restart)
    if(audio){
      try{ audio.pause(); audio.currentTime=0; audio.muted=false; await audio.play(); }catch(e){}
    }
  }

  // ===== Fireworks (infinite) =====
  const canvas=document.getElementById('fx'), ctx=canvas.getContext('2d');
  let W=0,H=0,parts=[],rockets=[],raf=null;
  const resize=()=>{ W=canvas.width=innerWidth; H=canvas.height=innerHeight; };
  addEventListener('resize', resize); resize();

  const R=(a,b)=>Math.random()*(b-a)+a;
  const hsv=(h,s,v)=>{ let f=(n,k=(n+h/60)%6)=>v-v*s*Math.max(Math.min(k,4-k,1),0); return [f(5),f(3),f(1)]; };

  function spawnRocket(){ rockets.push({x:R(W*.15,W*.85), y:H+10, vx:R(-1,1), vy:R(-12,-9), life:R(.9,1.3)}); }
  function explode(x,y){
    const n=120,hue=R(0,360);
    for(let i=0;i<n;i++){
      const sp=R(1,6), th=Math.random()*Math.PI*2;
      parts.push({x,y,vx:Math.cos(th)*sp,vy:Math.sin(th)*sp,a:1,d:R(.01,.02),h:hue,g:.05,s:R(1,2.5)});
    }
  }

  function loop(){
    ctx.globalCompositeOperation='destination-out';
    ctx.fillStyle='rgba(0,0,0,0.25)';
    ctx.fillRect(0,0,W,H);
    ctx.globalCompositeOperation='lighter';

    for(let i=rockets.length-1;i>=0;i--){
      const r=rockets[i];
      r.x+=r.vx; r.y+=r.vy; r.vy+=.06; r.life-=.02;
      ctx.fillStyle='rgba(255,255,255,0.9)';
      ctx.fillRect(r.x, r.y, 2, 2);
      if(r.vy>=0 || r.life<=0){ explode(r.x, r.y); rockets.splice(i,1); }
    }
    for(let i=parts.length-1;i>=0;i--){
      const p=parts[i];
      p.x+=p.vx; p.y+=p.vy; p.vy+=p.g; p.a-=p.d;
      const [r,g,b]=hsv(p.h,1,1);
      ctx.fillStyle=`rgba(${r*255|0},${g*255|0},${b*255|0},${Math.max(p.a,0)})`;
      ctx.beginPath(); ctx.arc(p.x,p.y,p.s,0,Math.PI*2); ctx.fill();
      if(p.a<=0) parts.splice(i,1);
    }
    raf=requestAnimationFrame(loop);
  }

  function startFireworks(){
    if(!raf){
      // spawn stream continuously
      setInterval(()=>{ spawnRocket(); }, 300);
      loop();
    }
  }
})();
</script>
</body>
</html>